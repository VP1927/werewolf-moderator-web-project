{"ast":null,"code":"import _objectSpread from \"/home/vp1927/study/werewolf/werewolf-moderator-web-project/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nvar _jsxFileName = \"/home/vp1927/study/werewolf/werewolf-moderator-web-project/src/view/game/MainGame.js\";\nimport React from 'react'; // import globalState from './GlobalState'\n\nconst globalState = {\n  players: [{\n    id: 0,\n    name: 'Nhi',\n    imageLink: '/images/Werewolf.jpg',\n    role: 'Werewolf'\n  }, {\n    id: 1,\n    name: 'Thoa',\n    imageLink: '/images/Werewolf.jpg',\n    role: 'Werewolf'\n  }, {\n    id: 2,\n    name: 'Cuong',\n    imageLink: '/images/Villager.jpg',\n    role: 'Villager'\n  }, {\n    id: 3,\n    name: 'Hanh',\n    imageLink: '/images/Hunter.jpg',\n    role: 'Hunter'\n  }]\n};\n\nclass Effect extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      effects: [] // this.handleEffect = this.handleEffect.bind(this);\n\n    };\n  }\n\n  componentDidMount() {\n    let link = 'http://localhost:8080/effect/' + this.props.idcard;\n    fetch(link).then(response => response.json()).then(data => this.setState({\n      effects: Array.from(data)\n    }));\n  }\n\n  handleEffect(e, effect) {\n    this.props.onHandleEffect(effect.name);\n\n    if (!effect.multitime) {\n      this.setState({\n        effects: this.state.effects.filter(function (eff) {\n          return eff !== effect;\n        })\n      });\n    }\n  }\n\n  render() {\n    const effects = this.state.effects;\n    if (!effects) return null;else return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52\n      },\n      __self: this\n    }, effects.map(effect => React.createElement(\"li\", {\n      key: effect.ideffect,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 54\n      },\n      __self: this\n    }, React.createElement(\"img\", {\n      className: \"icon\",\n      src: require = effect.iconLink,\n      name: effect.name,\n      onClick: e => this.handleEffect(e, effect),\n      alt: \"effect\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 55\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nclass MainGame extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      cards: [],\n      players: globalState.players,\n      phase: 'night',\n      effectState: {},\n      currentState: '',\n      couple: [],\n      summary: {\n        deaths: [],\n        number: 0\n      }\n    };\n    this.handleEffect = this.handleEffect.bind(this);\n    this.handleAffected = this.handleAffected.bind(this);\n    this.handlePhase = this.handlePhase.bind(this);\n    this.addIndirectDeath = this.addIndirectDeath.bind(this);\n  }\n\n  componentDidMount() {\n    fetch('http://localhost:8080/cardlist').then(response => response.json()).then(data => this.setState({\n      cards: data\n    }));\n  }\n\n  handleEffect(effect) {\n    this.setState({\n      currentState: effect\n    });\n  }\n\n  handleAffected(player) {\n    if (this.state.phase === 'night') {\n      const currentState = this.state.currentState;\n\n      if (currentState === '') {\n        alert('The effect has not been chosen');\n      } else if (currentState === 'Connect') {\n        if (this.state.couple.length < 2) {\n          this.setState(state => {\n            const couple = state.couple.concat(player);\n            return {\n              couple\n            };\n          });\n        }\n      } else {\n        this.setState(prevState => {\n          let effectState = _objectSpread({}, prevState.effectState);\n\n          effectState[this.state.currentState] = player;\n          return {\n            effectState\n          };\n        });\n      }\n    } else {\n      this.setState(prevState => {\n        let effectState = _objectSpread({}, prevState.effectState);\n\n        effectState['lynch'] = player;\n        return {\n          effectState\n        };\n      });\n    }\n  }\n\n  addIndirectDeath(deaths, directDeath) {\n    const couple = this.state.couple;\n    const effectState = this.state.effectState;\n\n    if (directDeath.role === 'Hunter') {\n      if (effectState['Shoot'] === couple[0] || effectState['Shoot'] === couple[1]) {\n        deaths.push(couple[0]);\n        deaths.push(couple[1]);\n      }\n\n      deaths.push(effectState['Shoot']);\n    }\n\n    if (directDeath === couple[0] || directDeath === couple[1]) {\n      if (directDeath.role === 'Hunter') {\n        deaths.push(effectState['Shoot']);\n      }\n\n      deaths.push(couple[0]);\n      deaths.push(couple[1]);\n    }\n  }\n\n  handlePhase() {\n    const effectState = this.state.effectState;\n    let deaths = [];\n\n    if (this.state.phase === 'night') {\n      const bittenPlayer = effectState['Bite'];\n\n      if (effectState['Protect'] !== bittenPlayer && effectState['Potion'] !== bittenPlayer) {\n        deaths.push(bittenPlayer);\n        this.addIndirectDeath(deaths, bittenPlayer);\n      }\n\n      if ('Poison' in effectState) {\n        deaths.push(effectState['Poison']);\n        this.addIndirectDeath(deaths, effectState['Poison']);\n      }\n\n      deaths = [...new Set(deaths)];\n      alert(deaths.length);\n      this.setState({\n        phase: 'day',\n        currentState: '',\n        summary: {\n          deaths: deaths,\n          number: deaths.length\n        },\n        players: this.state.players.filter(function (player) {\n          return deaths.indexOf(player) === -1;\n        })\n      });\n    } else {\n      deaths.push(effectState['lynch']);\n      this.addIndirectDeath(deaths, effectState['lynch']);\n      this.setState({\n        phase: 'night',\n        summary: {\n          deaths: [...new Set(deaths)],\n          number: this.state.summary.deaths.length\n        },\n        players: this.state.players.filter(function (player) {\n          return deaths.indexOf(player) === -1;\n        })\n      });\n    }\n  }\n\n  render() {\n    const cards = this.state.cards;\n    if (!cards) return null;else return React.createElement(\"div\", {\n      className: \"containerGamePlay\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, this.state.phase), React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"row\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"col-sm-4\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, cards.map(card => React.createElement(\"li\", {\n      key: card.idCard,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 219\n      },\n      __self: this\n    }, card.role), React.createElement(Effect, {\n      idcard: card.idCard,\n      onHandleEffect: this.handleEffect,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }))))), React.createElement(\"div\", {\n      className: \"col-sm-8\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 224\n      },\n      __self: this\n    }, React.createElement(\"ul\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }, this.state.players.map(player => React.createElement(\"li\", {\n      key: player.id,\n      onClick: () => this.handleAffected(player),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    }, React.createElement(\"h3\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228\n      },\n      __self: this\n    }, player.name), React.createElement(\"img\", {\n      className: \"image\",\n      src: player.imageLink,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }))))))), React.createElement(\"button\", {\n      onClick: this.handlePhase,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, \"Next phase\"), React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, this.state.summary.number));\n  }\n\n}\n\nexport default MainGame;","map":{"version":3,"sources":["/home/vp1927/study/werewolf/werewolf-moderator-web-project/src/view/game/MainGame.js"],"names":["React","globalState","players","id","name","imageLink","role","Effect","Component","constructor","props","state","effects","componentDidMount","link","idcard","fetch","then","response","json","data","setState","Array","from","handleEffect","e","effect","onHandleEffect","multitime","filter","eff","render","map","ideffect","require","iconLink","MainGame","cards","phase","effectState","currentState","couple","summary","deaths","number","bind","handleAffected","handlePhase","addIndirectDeath","player","alert","length","concat","prevState","directDeath","push","bittenPlayer","Set","indexOf","card","idCard"],"mappings":"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","sourcesContent":["import React from 'react';\n\n// import globalState from './GlobalState'\n\nconst globalState = {\n    players: [\n        { id: 0, name: 'Nhi', imageLink: '/images/Werewolf.jpg', role: 'Werewolf' },\n        { id: 1, name: 'Thoa', imageLink: '/images/Werewolf.jpg', role: 'Werewolf' },\n        { id: 2, name: 'Cuong', imageLink: '/images/Villager.jpg', role: 'Villager' },\n        { id: 3, name: 'Hanh', imageLink: '/images/Hunter.jpg', role: 'Hunter' }\n    ]\n};\n\nclass Effect extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            effects: [],\n        }\n\n        // this.handleEffect = this.handleEffect.bind(this);\n    }\n\n    componentDidMount() {\n        let link = 'http://localhost:8080/effect/' + this.props.idcard;\n        fetch(link)\n            .then(response => response.json())\n            .then(data => this.setState({ effects: Array.from(data) }));\n\n    }\n\n    handleEffect(e, effect) {\n        this.props.onHandleEffect(effect.name);\n\n        if (!effect.multitime) {\n            this.setState({\n                effects: this.state.effects.filter(function (eff) {\n                    return eff !== effect;\n                })\n            })\n        }\n\n    }\n\n    render() {\n        const { effects } = this.state;\n\n        if (!effects) return null;\n        else\n            return (\n                <div>\n                    <ul>\n                        {effects.map(effect =>\n                            <li key={effect.ideffect}>\n                                <img className='icon' src={require=(effect.iconLink)} name={effect.name} onClick={(e) => this.handleEffect(e, effect)} alt = 'effect' />\n                            </li>)}\n                    </ul>\n                </div>\n            );\n    }\n}\n\nclass MainGame extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            cards: [],\n            players: globalState.players,\n            phase: 'night',\n            effectState: {},\n            currentState: '',\n            couple: [],\n            summary: {\n                deaths: [],\n                number: 0\n            }\n        }\n\n        this.handleEffect = this.handleEffect.bind(this);\n        this.handleAffected = this.handleAffected.bind(this);\n        this.handlePhase = this.handlePhase.bind(this);\n        this.addIndirectDeath = this.addIndirectDeath.bind(this);\n    }\n\n    componentDidMount() {\n\n        fetch('http://localhost:8080/cardlist')\n            .then(response => response.json())\n            .then(data => this.setState({ cards: data }))\n    }\n\n    handleEffect(effect) {\n        this.setState({ currentState: effect });\n    }\n\n    handleAffected(player) {\n\n        if (this.state.phase === 'night') {\n            const currentState = this.state.currentState;\n\n            if (currentState === '') {\n                alert('The effect has not been chosen');\n            }\n\n            else if (currentState === 'Connect') {\n                if (this.state.couple.length < 2) {\n                    this.setState(state => {\n                        const couple = state.couple.concat(player);\n                        return { couple };\n                    });\n                }\n\n            }\n\n            else {\n                this.setState(prevState => {\n                    let effectState = { ...prevState.effectState };\n                    effectState[this.state.currentState] = player;\n                    return { effectState };\n                })\n            }\n        }\n\n        else {\n            this.setState(prevState => {\n                let effectState = { ...prevState.effectState };\n                effectState['lynch'] = player;\n                return { effectState };\n            })\n        }\n    }\n\n    addIndirectDeath(deaths, directDeath) {\n        const couple = this.state.couple;\n        const effectState = this.state.effectState;\n\n        if (directDeath.role === 'Hunter') {\n            if (effectState['Shoot'] === couple[0] || effectState['Shoot'] === couple[1]) {\n                deaths.push(couple[0]);\n                deaths.push(couple[1]);\n            }\n            deaths.push(effectState['Shoot']);\n\n        }\n\n        if (directDeath === couple[0] || directDeath === couple[1]) {\n            if (directDeath.role === 'Hunter') {\n                deaths.push(effectState['Shoot']);\n            }\n            deaths.push(couple[0]);\n            deaths.push(couple[1]);\n        }\n    }\n\n    handlePhase() {\n        const effectState = this.state.effectState;\n        let deaths = [];\n\n        if (this.state.phase === 'night') {\n            const bittenPlayer = effectState['Bite'];\n\n            if (effectState['Protect'] !== bittenPlayer && effectState['Potion'] !== bittenPlayer) {\n                deaths.push(bittenPlayer);\n                this.addIndirectDeath(deaths, bittenPlayer);\n            }\n\n            if (('Poison' in effectState)) {\n                deaths.push(effectState['Poison']);\n                this.addIndirectDeath(deaths, effectState['Poison']);\n            }\n\n            deaths = [...new Set(deaths)];\n            alert(deaths.length);\n\n            this.setState({\n                phase: 'day',\n                currentState: '',\n                summary: {\n                    deaths: deaths,\n                    number: deaths.length\n                },\n                players: this.state.players.filter(function (player) {\n                    return deaths.indexOf(player) === -1\n                })\n            })\n        }\n\n        else {\n            deaths.push(effectState['lynch']);\n            this.addIndirectDeath(deaths, effectState['lynch']);\n\n            this.setState({\n                phase: 'night',\n                summary: {\n                    deaths: [...new Set(deaths)],\n                    number: this.state.summary.deaths.length\n                },\n                players: this.state.players.filter(function (player) {\n                    return deaths.indexOf(player) === -1\n                })\n            });\n        }\n    }\n\n    render() {\n        const cards = this.state.cards;\n\n        if (!cards) return null;\n\n        else return (\n            <div className='containerGamePlay'>\n                <h1>{this.state.phase}</h1>\n                <div className='container'>\n                    <div className='row'>\n                        <div className='col-sm-4'>\n                            <ul>\n                                {cards.map(card =>\n                                    <li key={card.idCard}>\n                                        <h3>{card.role}</h3>\n                                        <Effect idcard={card.idCard} onHandleEffect={this.handleEffect} />\n                                    </li>)}\n                            </ul>\n                        </div>\n                        <div className='col-sm-8'>\n                            <ul>\n                                {this.state.players.map(player =>\n                                    <li key={player.id} onClick={() => this.handleAffected(player)}>\n                                        <h3>{player.name}</h3>\n                                        <img className='image' src={player.imageLink} />\n                                    </li>)}</ul>\n                        </div>\n                    </div>\n                </div>\n                <button onClick={this.handlePhase}>Next phase</button>\n                <p>{this.state.summary.number}</p>\n            </div>\n\n        )\n    }\n\n}\n\nexport default MainGame;\n"]},"metadata":{},"sourceType":"module"}